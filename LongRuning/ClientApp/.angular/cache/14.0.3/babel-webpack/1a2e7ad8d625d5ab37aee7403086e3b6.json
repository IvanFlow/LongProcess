{"ast":null,"code":"import _asyncToGenerator from \"C:/repos/LongRuning/LongRuning/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { ChangeDetectionStrategy, Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet EncoderComponent = class EncoderComponent {\n  constructor(cd, formBuilder) {\n    this.cd = cd;\n    this.formBuilder = formBuilder;\n    this.streamedResults = [];\n    this.myForm = this.formBuilder.group({\n      textToEncode: ['', [Validators.required]]\n    });\n    this.breakStreamFlag = {\n      value: false\n    };\n    this.convertDisable = false;\n  }\n\n  encodeText() {\n    var _a;\n\n    if (this.myForm.invalid) {\n      this.myForm.markAllAsTouched();\n      return;\n    }\n\n    this.convertDisable = true;\n    this.streamedResults = [];\n    const textToEncode = (_a = this.myForm.controls['textToEncode']) === null || _a === void 0 ? void 0 : _a.value;\n    this.getEncodedStreamed(textToEncode);\n  }\n\n  getEncodedStreamed(textToEncode) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const response = yield fetch(`https://localhost:7141/Encoder/EncodeBase64V2?textToEncode=${textToEncode}`, {\n        allowHTTP1ForStreamingUpload: true\n      });\n\n      if (response.body == null) {\n        throw new Error('Not possible in current scenario');\n      }\n\n      const reader = response.body.getReader();\n      const streamedResults = _this.streamedResults;\n      const cd = _this.cd;\n      const breakFlag = _this.breakStreamFlag;\n\n      function printStream() {\n        return _printStream.apply(this, arguments);\n      }\n\n      function _printStream() {\n        _printStream = _asyncToGenerator(function* () {\n          const {\n            done,\n            value\n          } = yield reader.read();\n\n          if (done || breakFlag.value) {\n            breakFlag.value = false;\n            return;\n          }\n\n          const textDecoder = new TextDecoder();\n          const stringValue = textDecoder.decode(value);\n          streamedResults.push(stringValue);\n          cd.markForCheck();\n          yield printStream();\n        });\n        return _printStream.apply(this, arguments);\n      }\n\n      yield printStream();\n      _this.convertDisable = false;\n    })();\n  }\n\n  validField(field) {\n    var _a, _b;\n\n    return ((_a = this.myForm.controls[field]) === null || _a === void 0 ? void 0 : _a.errors) && ((_b = this.myForm.controls[field]) === null || _b === void 0 ? void 0 : _b.touched);\n  }\n\n  stopStream() {\n    this.breakStreamFlag.value = true;\n  }\n\n  disableConvert() {\n    return this.convertDisable;\n  }\n\n};\nEncoderComponent = __decorate([Component({\n  selector: 'app-encoder',\n  templateUrl: './encoder.component.html',\n  changeDetection: ChangeDetectionStrategy.Default\n})], EncoderComponent);\nexport { EncoderComponent };","map":{"version":3,"mappings":"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","names":["ChangeDetectionStrategy","Component","Validators","EncoderComponent","constructor","cd","formBuilder","group","textToEncode","required","value","encodeText","myForm","invalid","markAllAsTouched","convertDisable","streamedResults","controls","_a","getEncodedStreamed","response","fetch","allowHTTP1ForStreamingUpload","body","Error","reader","getReader","breakFlag","breakStreamFlag","printStream","done","read","textDecoder","TextDecoder","stringValue","decode","push","markForCheck","validField","field","errors","_b","touched","stopStream","disableConvert","selector","templateUrl","changeDetection","Default"],"sourceRoot":"","sources":["C:\\repos\\LongRuning\\LongRuning\\ClientApp\\src\\app\\encoder\\encoder.component.ts"],"sourcesContent":["import { ChangeDetectionStrategy, ChangeDetectorRef, Component } from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\r\n\r\n@Component({\r\n  selector: 'app-encoder',\r\n  templateUrl: './encoder.component.html',\r\n  changeDetection: ChangeDetectionStrategy.Default\r\n})\r\nexport class EncoderComponent {\r\n  public streamedResults: string[] = [];\r\n  myForm: FormGroup = this.formBuilder.group({\r\n    textToEncode: ['', [Validators.required]]\r\n  });\r\n  breakStreamFlag = { value: false};\r\n  convertDisable: boolean = false;\r\n\r\n  constructor( private readonly cd: ChangeDetectorRef, private formBuilder: FormBuilder) {\r\n    \r\n  }\r\n\r\n  public encodeText() {\r\n    if (this.myForm.invalid) {\r\n      this.myForm.markAllAsTouched();\r\n      return;\r\n    }\r\n    this.convertDisable = true;\r\n    this.streamedResults = [];\r\n\r\n    const textToEncode = this.myForm.controls['textToEncode']?.value;\r\n    this.getEncodedStreamed(textToEncode);\r\n    \r\n\r\n  }\r\n\r\n  public async getEncodedStreamed(textToEncode: string): Promise<void> {\r\n    const response = await fetch(`https://localhost:7141/Encoder/EncodeBase64V2?textToEncode=${textToEncode}`, {\r\n      allowHTTP1ForStreamingUpload: true,\r\n    } as any);\r\n    if (response.body == null) {\r\n      throw new Error('Not possible in current scenario');\r\n    }\r\n    const reader = response.body.getReader();\r\n\r\n    const streamedResults = this.streamedResults;\r\n    const cd = this.cd;\r\n    const breakFlag = this.breakStreamFlag;\r\n\r\n    async function printStream(): Promise<void> {\r\n      const { done, value } = await reader.read();\r\n      if (done || breakFlag.value) {\r\n        breakFlag.value = false;\r\n        return;\r\n      }\r\n      const textDecoder = new TextDecoder();\r\n      const stringValue = textDecoder.decode(value);\r\n\r\n      streamedResults.push(stringValue);\r\n      cd.markForCheck();\r\n     \r\n      await printStream();\r\n    }\r\n    \r\n    await printStream();\r\n\r\n    this.convertDisable = false;\r\n  }\r\n\r\n  validField(field: string) {\r\n    return this.myForm.controls[field]?.errors && this.myForm.controls[field]?.touched\r\n  }\r\n\r\n  stopStream() {\r\n    this.breakStreamFlag.value = true;\r\n  }\r\n\r\n  disableConvert(): boolean {\r\n    return this.convertDisable;\r\n  }\r\n\r\n  \r\n\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}