{"ast":null,"code":"import _asyncToGenerator from \"C:/repos/LongRuning/LongRuning/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nexport class EncoderComponent {\n  constructor(baseUrl, cd) {\n    this.cd = cd;\n    this.encodedResult = '';\n    this.streamedResults = [];\n    this.getEncodedStreamed();\n  }\n\n  buildingResult() {\n    this.encodedResult = this.streamedResults.join(\"\");\n  }\n\n  getEncodedStreamed() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const response = yield fetch('https://localhost:7141/EncodeBase64?textToEncode=abcd', {\n        allowHTTP1ForStreamingUpload: true\n      });\n\n      if (response.body == null) {\n        throw new Error('Not possible in current scenario');\n      }\n\n      const reader = response.body.getReader();\n      const streamedResults = _this.streamedResults;\n      const encoded = _this.encodedResult;\n      const cd = _this.cd;\n\n      function printStream() {\n        return _printStream.apply(this, arguments);\n      }\n\n      function _printStream() {\n        _printStream = _asyncToGenerator(function* () {\n          const {\n            done,\n            value\n          } = yield reader.read();\n\n          if (done) {\n            return;\n          }\n\n          const textDecoder = new TextDecoder();\n          const stringValue = textDecoder.decode(value);\n          encoded === null || encoded === void 0 ? void 0 : encoded.concat(stringValue);\n          streamedResults.push(stringValue);\n          console.log(encoded);\n          cd.markForCheck();\n          yield printStream();\n        });\n        return _printStream.apply(this, arguments);\n      }\n\n      yield printStream();\n    })();\n  }\n\n}\n\nEncoderComponent.ɵfac = function EncoderComponent_Factory(t) {\n  return new (t || EncoderComponent)(i0.ɵɵdirectiveInject('BASE_URL'), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n};\n\nEncoderComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: EncoderComponent,\n  selectors: [[\"app-encoder\"]],\n  decls: 2,\n  vars: 1,\n  template: function EncoderComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"p\");\n      i0.ɵɵtext(1);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate(ctx.streamedResults.join(\"\"));\n    }\n  },\n  encapsulation: 2,\n  changeDetection: 0\n});","map":{"version":3,"mappings":";;AAOA,OAAM,MAAOA,gBAAP,CAAuB;EAI3BC,YAAiCC,OAAjC,EAAmEC,EAAnE,EAAwF;IAArB;IAH5D,qBAAoC,EAApC;IACA,uBAA4B,EAA5B;IAIL,KAAKC,kBAAL;EAGD;;EAEMC,cAAc;IACnB,KAAKC,aAAL,GAAqB,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,EAA1B,CAArB;EACD;;EAIYJ,kBAAkB;IAAA;;IAAA;MAC7B,MAAMK,QAAQ,SAASC,KAAK,CAAC,uDAAD,EAA0D;QACpFC,4BAA4B,EAAE;MADsD,CAA1D,CAA5B;;MAGA,IAAIF,QAAQ,CAACG,IAAT,IAAiB,IAArB,EAA2B;QACzB,MAAM,IAAIC,KAAJ,CAAU,kCAAV,CAAN;MACD;;MACD,MAAMC,MAAM,GAAGL,QAAQ,CAACG,IAAT,CAAcG,SAAd,EAAf;MAEA,MAAMR,eAAe,GAAG,KAAI,CAACA,eAA7B;MACA,MAAMS,OAAO,GAAG,KAAI,CAACV,aAArB;MACA,MAAMH,EAAE,GAAG,KAAI,CAACA,EAAhB;;MAX6B,SAadc,WAbc;QAAA;MAAA;;MAAA;QAAA,iCAa7B,aAA0B;UACxB,MAAM;YAAEC,IAAF;YAAQC;UAAR,UAAwBL,MAAM,CAACM,IAAP,EAA9B;;UACA,IAAIF,IAAJ,EAAU;YACR;UACD;;UACD,MAAMG,WAAW,GAAG,IAAIC,WAAJ,EAApB;UACA,MAAMC,WAAW,GAAGF,WAAW,CAACG,MAAZ,CAAmBL,KAAnB,CAApB;UAEAH,OAAO,SAAP,WAAO,WAAP,GAAO,MAAP,UAAO,CAAES,MAAT,CAAgBF,WAAhB;UACAhB,eAAe,CAACmB,IAAhB,CAAqBH,WAArB;UAEAI,OAAO,CAACC,GAAR,CAAYZ,OAAZ;UAEAb,EAAE,CAAC0B,YAAH;UAGA,MAAMZ,WAAW,EAAjB;QACD,CA9B4B;QAAA;MAAA;;MAgC7B,MAAMA,WAAW,EAAjB;IAhC6B;EAiC9B;;AAlD0B;;;mBAAhBjB,kBAAgB8B,qBAIN,UAJM,GAIIA;AAAA;;;QAJpB9B;EAAgB+B;EAAAC;EAAAC;EAAAC;IAAA;MCP7BJ;MAAGA;MAA4BA;;;;MAA5BA;MAAAA","names":["EncoderComponent","constructor","baseUrl","cd","getEncodedStreamed","buildingResult","encodedResult","streamedResults","join","response","fetch","allowHTTP1ForStreamingUpload","body","Error","reader","getReader","encoded","printStream","done","value","read","textDecoder","TextDecoder","stringValue","decode","concat","push","console","log","markForCheck","i0","selectors","decls","vars","template"],"sourceRoot":"","sources":["C:\\repos\\LongRuning\\LongRuning\\ClientApp\\src\\app\\encoder\\encoder.component.ts","C:\\repos\\LongRuning\\LongRuning\\ClientApp\\src\\app\\encoder\\encoder.component.html"],"sourcesContent":["import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-encoder',\r\n  templateUrl: './encoder.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class EncoderComponent {\r\n  public encodedResult: string | undefined = '';\r\n  public streamedResults: string[] = [];\r\n\r\n  constructor( @Inject('BASE_URL') baseUrl: string, private readonly cd: ChangeDetectorRef) {\r\n\r\n    this.getEncodedStreamed();\r\n\r\n\r\n  }\r\n\r\n  public buildingResult() {\r\n    this.encodedResult = this.streamedResults.join(\"\");\r\n  }\r\n\r\n  \r\n\r\n  public async getEncodedStreamed(): Promise<void> {\r\n    const response = await fetch('https://localhost:7141/EncodeBase64?textToEncode=abcd', {\r\n      allowHTTP1ForStreamingUpload: true,\r\n    } as any);\r\n    if (response.body == null) {\r\n      throw new Error('Not possible in current scenario');\r\n    }\r\n    const reader = response.body.getReader();\r\n\r\n    const streamedResults = this.streamedResults;\r\n    const encoded = this.encodedResult;\r\n    const cd = this.cd;\r\n\r\n    async function printStream(): Promise<void> {\r\n      const { done, value } = await reader.read();\r\n      if (done) {\r\n        return;\r\n      }\r\n      const textDecoder = new TextDecoder();\r\n      const stringValue = textDecoder.decode(value);\r\n\r\n      encoded?.concat(stringValue);\r\n      streamedResults.push(stringValue);\r\n\r\n      console.log(encoded);\r\n\r\n      cd.markForCheck();\r\n     \r\n\r\n      await printStream();\r\n    }\r\n    \r\n    await printStream();\r\n  }\r\n\r\n  \r\n\r\n\r\n}\r\n","<p>{{streamedResults.join(\"\")}}</p>\r\n"]},"metadata":{},"sourceType":"module"}